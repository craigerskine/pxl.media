---
layout: 'layouts/default.njk'
title: Search results
---

{%- import 'components/heading.njk' as heading %}

<div x-data="appdata">
  {%- call heading.x(tag='h1') %}<span x-html="' &quot;'+ query +'&quot;'"></span> {{ title }}{%- endcall %}
  <ul x-show="results" class="px-4">
    <template x-for="item in getItems" hidden>
      <li class="game py-6 flex-(& col) items-center gap-4 md:(flex-row gap-10)">

        <div class="box w-full flex relative overflow-hidden rounded-lg shadow-xl">
          <img :src="'/_assets/img/games/'+ slugify(item.title) +'.jpg'" :alt="item.title" class="w-24 h-full" />
          <div class="details w-full min-w-0 flex">
            <div class="meta px-5 pt-3 pb-0 w-full min-w-0 flex-1 flex flex-col justify-between motion-safe:transition-all">
              <div class="mast mb-2">
                <b class="name text-white truncate block text-base font-black" :title="item.title" x-text="item.title"></b>
                <template x-if="item.note" hidden>
                  <p class="note text-sm inline-flex items-center gap-1">
                    <i x-text="item.note"></i>
                  </p>
                </template>
              </div>
              <ul class="flex w-full border-gray-500/30 py-2 text-base border-dashed items-center border-t">
                <li class="flex-1">
                  <ul class="flex items-center space-x-4">
                    <li x-text="item.platform" class="text-sm"></li>
                  </ul>
                </li>
                <li class="ml-auto">
                  <ul class="flex items-center space-x-2">
                    <li class="genre text-sm flex-(& wrap) gap-1">
                      <template x-for="(g, index) in item.genre" hidden>
                        <span>
                          <span class="genre" x-text="g"></span>
                          <span x-text="((index + 1) < item.genre.length) ? ',' : ''"></span>
                        </span>
                      </template>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </li>
    </template>
  </ul>
  <h2 x-show="!results" class="m-auto py-8 px-4 text-(gray-500 3xl center) leading-none font-bold md:(py-32)">
    NO RESULTS
    <small class="pt-5 text-lg block opacity-80 md:(text-2xl)">↑ ↑ ↓ ↓ ← → ← → B A</small>
  </h2>
</div>

<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('appdata', () => ({
      query: new URLSearchParams(location.search).get('q'),
      results: false,
      get getItems() {
        const filterItems = this.games.filter((item) => {
          const qy = this.query.toString().toLowerCase().replace(/[^\w\-]+/g, '') ?? ''
          const tl = item.title.toString().normalize('NFKD').toLowerCase().replace(/[^\w\-]+/g, '') ?? ''
          const nt = item.note.toString().toLowerCase().replace(/[^\w\-]+/g, '') ?? ''
          const arr = [tl, nt]
          return arr.some(rs => rs.includes(qy))
        })
        if(filterItems.length < this.games.length && filterItems.length > 0) {
          this.results = true
          return filterItems
        } else {
          this.results = false
        }
      },
      slugify(text) {
        return text.toString()
          .toLowerCase()
          .trim()
          .replace(/\s+/g, '-')
          .replace('&', '-and-')
          .normalize('NFKD')
          .replace(/[^\w\-]+/g, '')
          .replace(/\-\-+/g, '-')
          .replace(/^-+/, '')
          .replace(/-+$/, '')
      },
      games: [{%- for item in collections.game | sort(false, false, "data.title") -%}
        {
          title: "{{ item.data.title | safe }}",
          note: "{{ item.data.note | safe }}",
          genre: [
            {%- for g in item.data.tags -%}
              {%- if g.includes('genre_') -%}
                "{{ g | replace('genre_', '') | replace('-', ' ') | title | replace('Rpg', 'RPG') | replace('Playstation', 'PlayStation') }}",
              {%- endif -%}
            {%- endfor -%}
          ],
          platform: "
            {%- for t in item.data.tags -%}
              {%- if t.includes('platform_') -%}
                {{ t | replace('platform_', '') | replace('-', ' ') | title | replace('ds', 'DS') | replace('Ds', 'DS') | replace('Playstation', 'PlayStation') }}
              {%- endif -%}
            {%- endfor -%}
          "
        },
      {%- endfor -%}],
    }));
  })
</script>